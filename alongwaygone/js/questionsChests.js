const questionsChestsPages = [
  // LEVEL 1
  [
    {
      question: "(Chapter 1) What was Ishmael's initial understanding of war before it reached his village?",
      options: [
        { option: "He thought it was exciting.", "answer": 0 },
        { option: "He viewed it as abstract and unimaginable.", "answer": 1 },
        { option: "He was well-prepared and knowledgeable.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 1) What influence did rap music have on Ishmael and his friends?",
      options: [
        { option: "It made them famous in their village.", "answer": 0 },
        { option: "It was a hobby they occasionally enjoyed.", "answer": 0 },
        { option: "It defined how they dressed and spoke.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 1) What did Ishmael and his friends do when they heard that rebels had attacked their home village?",
      options: [
        { option: "They immediately joined the army.", "answer": 0 },
        { option: "They decided to return to their village to find their families.", "answer": 1 },
        { option: "They stayed in Mattru Jong to avoid danger.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 2) How does Ishmael describe his actions as a soldier?",
      options: [
        { option: "He implicates himself as unfeeling and callous.", "answer": 1 },
        { option: "He feels proud of defending his country.", "answer": 0 },
        { option: "He is indifferent and uninvolved.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 2) What is Ishmael's reaction to his own nightmares?",
      options: [
        { option: "He finds them comforting.", "answer": 0 },
        { option: "He is terrified and longs for daylight.", "answer": 1 },
        { option: "He ignores them and focuses on his daily tasks.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 2) What does Ishmael long for in his new life in New York City?",
      options: [
        { option: "To forget his past completely.", "answer": 0 },
        { option: "To return to Sierra Leone and fight.", "answer": 0 },
        { option: "To reclaim some joy from his childhood.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 3) What news does the messenger bring to Mattru Jong?",
      options: [
        { option: "The rebels will be arriving soon.", "answer": 1 },
        { option: "The government has defeated the rebels.", "answer": 0 },
        { option: "The village needs to prepare for a flood.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 3) How do Ishmael and his friends react when the rebels finally attack Mattru Jong?",
      options: [
        { option: "They hide in their homes.", "answer": 0 },
        { option: "They flee the village immediately.", "answer": 1 },
        { option: "They try to negotiate with the rebels.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 4) What immediate challenge do Ishmael, his brother, and their friends face after leaving Mattru Jong?",
      options: [
        { option: "They struggle with extreme hunger as they walk.", "answer": 1 },
        { option: "They are captured by a rival group of soldiers.", "answer": 0 },
        { option: "They find a safe haven in a neighboring village.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 4) What decision do Ishmael and his friends make when they find Khalilou's house destroyed?",
      options: [
        { option: "They decide to bury the bodies of Khalilou’s family.", "answer": 0 },
        { option: "They retrieve Ishmael's tiny bag of money stashed under the bed.", "answer": 1 },
        { option: "They leave immediately to avoid danger.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 4) How do Ishmael and his group manage to survive after finding themselves without sufficient provisions?",
      options: [
        { option: "They rely on aid from nearby villagers.", "answer": 0 },
        { option: "They start hunting wild animals.", "answer": 0 },
        { option: "They steal food during the night.", "answer": 1 }
      ]
    }
  ],
  // LEVEL 2
  [
    {
      question: "(Chapter 5) What drove Ishmael and his group to chase down a child eating corn?",
      options: [
        { option: "They were playing a game.", "answer": 0 },
        { option: "They wanted to bully the child.", "answer": 0 },
        { option: "They were too hungry to resist.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 5) How did the rebels force Ishmael and his friends to violate social norms during their capture?",
      options: [
        { option: "By making them steal from the elderly.", "answer": 0 },
        { option: "By forcing them to disrespect and laugh at an elder's torture.", "answer": 1 },
        { option: "By having them lie about their ages.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 5) What emotional response did Ishmael's group have after escaping the rebels by the riverbank?",
      options: [
        { option: "They were overjoyed and celebrated.", "answer": 0 },
        { option: "They were numb and shockingly silent.", "answer": 1 },
        { option: "They immediately planned their next move.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 6) Why were Ishmael and his friends often feared by local villagers?",
      options: [
        { option: "They traveled as a band of young boys.", "answer": 1 },
        { option: "They were known to be violent.", "answer": 0 },
        { option: "They wore rebel uniforms.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 6) How were Ishmael and his friends proven not to be rebels in one village?",
      options: [
        { option: "They showed their school IDs.", "answer": 0 },
        { option: "They were recognized by a local elder.", "answer": 0 },
        { option: "A young boy recognized them.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 6) What happened to Ishmael and his friends during their stay in Kamator?",
      options: [
        { option: "They were welcomed as heroes.", "answer": 0 },
        { option: "They had to abandon the town during a rebel attack.", "answer": 1 },
        { option: "They decided to leave voluntarily.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 7) What was the fate of the imam during the rebel attack on Kamator?",
      options: [
        { option: "He was tied to a post and set on fire.", "answer": 1 },
        { option: "He escaped into the bush.", "answer": 0 },
        { option: "He negotiated with the rebels for peace.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 7) What decision did Ishmael make after hiding for two weeks post-attack?",
      options: [
        { option: "He returned to fight the rebels.", "answer": 0 },
        { option: "He set out on his own.", "answer": 1 },
        { option: "He tried to find his family.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 7) What does the treatment of the imam by the rebels illustrate about the war?",
      options: [
        { option: "The complete disregard for morality by the rebels.", "answer": 1 },
        { option: "The rebels’ fear of religious figures.", "answer": 0 },
        { option: "The imam’s hidden alliances with rebel forces.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 8) What primarily kept Ishmael moving through deserted villages?",
      options: [
        { option: "The terror he saw in the victims' faces.", "answer": 1 },
        { option: "The search for food.", "answer": 0 },
        { option: "The guidance from other survivors.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 8) How did Ishmael initially react to reuniting with other boys after a month alone?",
      options: [
        { option: "He was immediately comfortable and happy.", "answer": 0 },
        { option: "He was uncomfortable and unsure how to behave.", "answer": 1 },
        { option: "He decided to leave them immediately.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 8) What challenge did Ishmael and his group face when approaching villages?",
      options: [
        { option: "They were often welcomed with open arms.", "answer": 0 },
        { option: "They were attacked.", "answer": 1 },
        { option: "They were ignored and left to fend for themselves.", "answer": 0 }
      ]
    }
  ],
// LEVEL 3
  [  
    {
      question: "(Chapter 9) What did Ishmael and his group initially expect when they reached the village by the ocean?",
      options: [
        { option: "They expected to be welcomed since they assumed war hadn't reached there.", "answer": 1 },
        { option: "They planned to hide from the locals.", "answer": 0 },
        { option: "They intended to join the village's defense against the rebels.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 9) How did the villagers first react when Ishmael and his group arrived?",
      options: [
        { option: "They welcomed them warmly and offered food.", "answer": 0 },
        { option: "They attacked and bound the boys, stealing their shoes.", "answer": 1 },
        { option: "They ignored the boys and left them alone.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 9) What role did rap music play when Ishmael and his friends were captured by the villagers for the second time?",
      options: [
        { option: "It was used as evidence against them.", "answer": 0 },
        { option: "The chief ordered Ishmael to perform, realizing they were just children.", "answer": 1 },
        { option: "It frightened the villagers, causing them to drive the boys away.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 9) What does the ocean symbolize for Ishmael and his friends when they first encounter it?",
      options: [
        { option: "A barrier they cannot cross.", "answer": 0 },
        { option: "A new beginning and a brief return to childhood.", "answer": 1 },
        { option: "An ominous force to be feared.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 10) What does Ishmael reflect on regarding his experiences with death?",
      options: [
        { option: "He feels he becomes stronger with each encounter.", "answer": 0 },
        { option: "He worries that a part of him dies a little each time.", "answer": 1 },
        { option: "He becomes indifferent to the constant threat of death.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 10) How do the boys react when a stray dog steals their bag of dried meat?",
      options: [
        { option: "They chase and harm the dog.", "answer": 0 },
        { option: "They lament but realize their growing desperation might change their behavior in the future.", "answer": 1 },
        { option: "They find and adopt the dog as a companion.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 10) What method do the boys use to cope with the trauma of their experiences?",
      options: [
        { option: "They often talk about their feelings.", "answer": 0 },
        { option: "They rely on silence to protect themselves.", "answer": 1 },
        { option: "They write down their stories in a journal.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 10) What happens to Saidu at the end of the chapter?",
      options: [
        { option: "He recovers after resting in the village.", "answer": 0 },
        { option: "He gets lost during their travels.", "answer": 0 },
        { option: "He dies after repeatedly fainting and they bury him.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 11) What interrupts Ishmael's group as they help Gasemu with the bananas?",
      options: [
        { option: "An earthquake shakes the village.", "answer": 0 },
        { option: "They are attacked by a wild animal.", "answer": 0 },
        { option: "The village is under attack by rebels.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 11) How does Ishmael react when he cannot find his family in the burned hut?",
      options: [
        { option: "He calmly waits for further news.", "answer": 0 },
        { option: "He attacks Gasemu in anger.", "answer": 1 },
        { option: "He immediately tries to rebuild the hut.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 11) What happens to Gasemu towards the end of the chapter?",
      options: [
        { option: "He escapes into the forest unharmed.", "answer": 0 },
        { option: "He is revealed to be a rebel spy.", "answer": 0 },
        { option: "He dies from gunshot wounds.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 11) How do the boys and the forest interact in this chapter?",
      options: [
        { option: "The forest acts as a protective cover, enhancing their senses and hiding them from danger.", "answer": 1 },
        { option: "The forest is a source of food and shelter for the group.", "answer": 0 },
        { option: "The forest becomes a maze that confuses them, causing them to lose their way.", "answer": 0 }
      ]
    }
  ],
  // LEVEL 4
  [
    {
      question: "(Chapter 12) What is Ishmael's initial role in the village of Yele?",
      options: [
        { option: "He serves as a guard for the military.", "answer": 0 },
        { option: "He performs chores like chopping vegetables and washing dishes.", "answer": 1 },
        { option: "He teaches other children how to read and write.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 12) What difficult choice are Ishmael and the other boys given in Yele?",
      options: [
        { option: "Leave the village or help in the medical camp.", "answer": 0 },
        { option: "Join the military forces or leave the village.", "answer": 1 },
        { option: "Stay in the village or go on scouting missions.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 12) What happens to Ishmael's personal belongings when he is moved to the soldiers' barracks?",
      options: [
        { option: "They are stored safely by the military.", "answer": 0 },
        { option: "His old clothes and cassette tapes are burned.", "answer": 1 },
        { option: "They are given to younger children in the village.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 12) How does the military motivate Ishmael and his friends to fight?",
      options: [
        { option: "By promising them education and a better future.", "answer": 0 },
        { option: "By reminding them that the rebels killed their families.", "answer": 1 },
        { option: "By offering them food and shelter.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 13) What temporary relief do the boys experience before being sent to fight?",
      options: [
        { option: "They are allowed to visit their families.", "answer": 0 },
        { option: "They play soccer and swim.", "answer": 1 },
        { option: "They receive medical check-ups.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 13) What is given to Ishmael before his first battle?",
      options: [
        { option: "A white tablet to boost energy.", "answer": 1 },
        { option: "A protective amulet.", "answer": 0 },
        { option: "A new set of clothes.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 13) What personal loss does Ishmael suffer during his first battle?",
      options: [
        { option: "He loses his only photograph of his family.", "answer": 0 },
        { option: "His close friends Musa and Josiah are killed.", "answer": 1 },
        { option: "He loses a cherished necklace from his mother.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 13) How does Ishmael cope with his experiences after the battle?",
      options: [
        { option: "He seeks comfort from the village elders.", "answer": 0 },
        { option: "He is given more pills to numb his pain.", "answer": 1 },
        { option: "He writes about his feelings in a journal.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 14) Besides white energy pills, what other substances does Ishmael use to cope with war?",
      options: [
        { option: "Marijuana and 'brown brown,' a mixture of cocaine and gunpowder.", "answer": 1 },
        { option: "Alcohol and sleeping pills.", "answer": 0 },
        { option: "Herbal remedies provided by the villagers.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 14) What brutal competition does Ishmael participate in?",
      options: [
        { option: "A shooting accuracy contest.", "answer": 0 },
        { option: "A throat-slitting contest using bayonets.", "answer": 1 },
        { option: "A hand-to-hand combat challenge.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 14) What new role is Ishmael awarded after the competition?",
      options: [
        { option: "Chief scout.", "answer": 0 },
        { option: "Junior lieutenant.", "answer": 1 },
        { option: "Squad leader.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 14) How does Ishmael's perception of violence change by the end of Chapter 14?",
      options: [
        { option: "He becomes fearful of all forms of violence.", "answer": 0 },
        { option: "He finds killing as easy as drinking water.", "answer": 1 },
        { option: "He vows to never engage in violence again after the war.", "answer": 0 }
      ]
    }
  ],
  // LEVEL 5
  [
    {
      question: "(Chapter 15) What change occurs for Ishmael when UNICEF arrives?",
      options: [
        { option: "He is promoted to a higher rank in the army.", "answer": 0 },
        { option: "He is taken to a rehabilitation center.", "answer": 1 },
        { option: "He is given a new assignment in the war.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 15) How do the boys react to their new environment in Freetown?",
      options: [
        { option: "They adapt quickly and peacefully.", "answer": 0 },
        { option: "They are confused and initially resist the comforts offered.", "answer": 1 },
        { option: "They escape the compound on the first night.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 15) What triggers a violent outbreak among the boy soldiers in the rehabilitation camp?",
      options: [
        { option: "A dispute over food portions.", "answer": 0 },
        { option: "The arrival of boy soldiers from the RUF.", "answer": 1 },
        { option: "A competitive sports event.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 15) How does Ishmael view his lieutenant at the beginning of the chapter?",
      options: [
        { option: "As an enemy.", "answer": 0 },
        { option: "As a father figure whose approval he seeks.", "answer": 1 },
        { option: "Indifferently, as just another officer.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 16) How do Ishmael and the other boys express their struggle with adapting to rehabilitation?",
      options: [
        { option: "They become quiet and withdrawn.", "answer": 0 },
        { option: "They engage in violent and destructive behavior.", "answer": 1 },
        { option: "They attempt to run away from the center.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 16) What action does Ishmael take that leads him to meet a kind nurse?",
      options: [
        { option: "He falls ill during a therapy session.", "answer": 0 },
        { option: "He uses his bare hands to break windows and injures himself.", "answer": 1 },
        { option: "He tries to escape the rehabilitation center.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 16) How does the staff at the rehabilitation center respond to the boys' violent outbursts?",
      options: [
        { option: "With strict punishment and restrictions.", "answer": 0 },
        { option: "By calling the police and increasing security.", "answer": 0 },
        { option: "With patience, kindness, and forgiveness.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 17) What helps Ishmael to start opening up about his past?",
      options: [
        { option: "A conversation with another boy soldier.", "answer": 0 },
        { option: "Sessions with a psychiatrist.", "answer": 0 },
        { option: "A Walkman and rap cassettes given to him by Esther.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 17) What is Ishmael's initial reaction to therapy and discussions about his past?",
      options: [
        { option: "He is eager and cooperative.", "answer": 0 },
        { option: "He becomes angry and throws the Walkman at Esther.", "answer": 1 },
        { option: "He remains silent and refuses to participate.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 17) How does Ishmael's view on his actions during the war begin to change?",
      options: [
        { option: "He feels justified and unrepentant.", "answer": 0 },
        { option: "He starts to consider that maybe he is not at fault.", "answer": 1 },
        { option: "He plans to write a book about his experiences.", "answer": 0 }
      ]
    }
  ],
  // LEVEL 6
  [
    {
      question: "(Chapter 18) What role does Ishmael take on at the rehabilitation center that hints at his recovery?",
      options: [
        { option: "He becomes a spokesperson for the center.", "answer": 1 },
        { option: "He assists the staff as a junior counselor.", "answer": 0 },
        { option: "He starts a support group for other child soldiers.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 18) How does Ishmael react when he meets his Uncle Tommy for the first time?",
      options: [
        { option: "He is distrustful and refuses to speak with him.", "answer": 0 },
        { option: "He is hesitant but eventually warms up to him.", "answer": 1 },
        { option: "He immediately recognizes him and feels at home.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 18) What does Ishmael perform at the talent show organized by the center?",
      options: [
        { option: "A rap song he wrote.", "answer": 0 },
        { option: "A monologue from Shakespeare and a dance performance.", "answer": 1 },
        { option: "A dramatic reading of his own poetry.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 18) What significant change in Ishmael’s life is introduced by the end of Chapter 18?",
      options: [
        { option: "He decides to return to his village and search for his family.", "answer": 0 },
        { option: "He is adopted by Uncle Tommy and begins a new life.", "answer": 1 },
        { option: "He leaves Sierra Leone to speak about his experiences internationally.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 19) What motivates Ishmael to apply to be part of the UN delegation?",
      options: [
        { option: "Leslie's encouragement and his desire to share his story.", "answer": 1 },
        { option: "A promise of financial reward.", "answer": 0 },
        { option: "The chance to return to his soldier life legally.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 19) How does Ishmael react when asked for a birth certificate at the embassy?",
      options: [
        { option: "He calmly explains the situation in Sierra Leone.", "answer": 0 },
        { option: "He is indifferent, having expected such a request.", "answer": 0 },
        { option: "He becomes furious at the lack of awareness about war conditions.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 19) What significant step does Ishmael take towards healing in this chapter?",
      options: [
        { option: "He publicly forgives the rebels.", "answer": 0 },
        { option: "He chooses to speak out about his experiences.", "answer": 1 },
        { option: "He reunites with his lost family.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 19) What aspect of Ishmael's personality is highlighted during his interview for the UN delegation?",
      options: [
        { option: "His hesitation and self-doubt.", "answer": 0 },
        { option: "His pride in his firsthand experience of war and rehabilitation.", "answer": 1 },
        { option: "His regret and remorse over his past actions.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 20) What initial impression does New York City make on Ishmael?",
      options: [
        { option: "He finds it warm and welcoming.", "answer": 0 },
        { option: "He is overwhelmed and confused by its size.", "answer": 0 },
        { option: "He is surprised by how different it is from his expectations based on rap music.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 20) What does Ishmael discuss in his speech at the United Nations Conference?",
      options: [
        { option: "The need for increased military aid to Sierra Leone.", "answer": 0 },
        { option: "The destructive nature of revenge in perpetuating war.", "answer": 1 },
        { option: "His desire to return to Sierra Leone and rebuild his village.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 20) How does Ishmael's relationship with Laura Simms begin to change his outlook?",
      options: [
        { option: "She encourages him to continue fighting.", "answer": 0 },
        { option: "She invites him to express himself through stories and music.", "answer": 1 },
        { option: "She advises him to forget his past and focus on the future.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 20) What future plan does Ishmael reveal at the end of Chapter 20?",
      options: [
        { option: "To become a leader in Sierra Leone.", "answer": 0 },
        { option: "To move to the United States and live with Laura Simms.", "answer": 1 },
        { option: "To travel the world and advocate for child soldiers.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 21) How do Ishmael's schoolmates react to him when he returns to school in Freetown?",
      options: [
        { option: "They welcome him back with open arms.", "answer": 0 },
        { option: "They are indifferent, treating him as they would any other student.", "answer": 0 },
        { option: "They fear him and avoid contact.", "answer": 1 }
      ]
    },
    {
      question: "(Chapter 21) What tragic event happens to Uncle Tommy during the coup?",
      options: [
        { option: "He is arrested by the rebels.", "answer": 0 },
        { option: "He falls ill and passes away.", "answer": 1 },
        { option: "He is forced to flee the country.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 21) How does Ishmael respond to the renewed violence in Freetown?",
      options: [
        { option: "He decides to rejoin the military.", "answer": 0 },
        { option: "He resolves to leave Sierra Leone for his safety.", "answer": 1 },
        { option: "He becomes an activist within his community.", "answer": 0 }
      ]
    },
    {
      question: "(Chapter 21) What decision does Ishmael make about his future at the end of the chapter?",
      options: [
        { option: "To stay in Sierra Leone and help rebuild the country.", "answer": 0 },
        { option: "To go into hiding to avoid being drafted again.", "answer": 0 },
        { option: "To escape to New York and start a new life with Laura Simms.", "answer": 1 }
      ]
    }
  ]
]




// A copy of the questions for active use in the game, allowing for modifications
let questionsChestsPagesActive = JSON.parse(JSON.stringify(questionsChestsPages));

// Resets the active questions to the original set
const resetPages = () => {
  questionsChestsPagesActive = JSON.parse(JSON.stringify(questionsChestsPages));
}

// Function to handle chest encounters with questions
const questionChestFunction = (scene, chestBox, gameState, destroyArray, player, TILES, groundLayer, chestopen, dungeon, level) => {
  // Function to calculate the typing speed based on word length
  const getNextSpeed = (text, currentIndex) => {
    let spaceIndex = text.indexOf(' ', currentIndex);
    if (spaceIndex === -1) spaceIndex = text.length;
    let wordLength = spaceIndex - currentIndex;
    return wordLength > 5 ? 1 : 50;
  }

  // Function to type out text character by character
  const typeText = (scene, textObject, targetText, startDelay = 0, index = 0, onComplete = null, onCompleteDelay = 0) => {
    if (index < targetText.length) {
      scene.time.delayedCall(startDelay, () => {
        textObject.setText(targetText.substring(0, index + 1));
        typeText(scene, textObject, targetText, getNextSpeed(targetText, index), index + 1, onComplete, onCompleteDelay);
      });
    } else if (onComplete) {
      scene.time.delayedCall(onCompleteDelay, () => {
        onComplete();
      });
    }
  }

  // Zoom in and pause the game
  scene.cameras.main.zoom = 2;
  scene.physics.world.pause();

  // Coordinates for text placement
  const centerX = scene.cameras.main.width / 2;
  const centerY = scene.cameras.main.height / 2;

  // Create a text box for the question
  const textBoxb = scene.add.rectangle(centerX, centerY - 95, 420, 190, 0x000000).setScrollFactor(0);
  const textBox = scene.add.rectangle(centerX, centerY - 95, 400, 170, 0xFFFFFF).setScrollFactor(0);
  textBox.setOrigin(0.5);

  // Array of introduction messages for the question
  const messageOptions = [
    "Opening the book, you remember Anansi the Spider, who outsmarted the Lion to bring stories to the world.",
    "Finding a book under the baobab tree, you recall the tale of the Moon and the Sun, originators of day and night.",
    "In a book, you uncover a tale of Makeda, Queen of Sheba, whose wisdom brought prosperity to her lands.",
    "A hidden book reveals the legend of Sundiata Keita, Mali’s founder, known for his strength and foresight.",
    "Unearthing a beaded book, you remember Oba Ewuare of Benin, who turned his city into a symbol of wealth and splendor.",
    "Inside a small book, you find the story of the tortoise and the elephant, a tale of cunning over brute strength.",
    "As you open the book, the tale of Yennenga, the warrior princess of the Mossi, comes to your mind.",
    "You discover the story of the wise judge, Khama, who outwitted a cunning thief with his profound wisdom.",
    "A dusty book holds the story of the first rains, brought by the dance of the zebra and the giraffe.",
    "The tale of the laughing fish that saved a village from famine is found in a moss-covered book.",
    "You recall the legend of Nandi, the mother of Shaka Zulu, whose love and protection shaped a king.",
    "Opening a book, you remember the story of Baobab, the tree that stood up to the mighty wind.",
    "A book by the river whispers the story of Nyami Nyami, the river god who protects his people.",
    "In a book covered with kente cloth, you find the legend of the Ashanti golden stool, descended from the sky.",
    "You unlock a book to find the tale of Mansa Musa's pilgrimage, spreading wealth and wisdom.",
    "A book filled with seashells holds the story of Mami Wata, the spirit of water and beauty.",
    "You find the story of the leopard man, a hero who taught his people to hunt and survive.",
    "Opening a book carved with lions, you remember the story of the lion's mane, which brought courage to a young warrior.",
    "A book in a cave reveals the legend of the ghostly drummers who led a lost tribe to safety.",
    "Inside a book painted with stars, you learn of the sky maiden who weaved the night sky.",
    "The tale of a clever monkey who tricked the crocodile to escape from its clutches is found in a wooden book.",
    "You discover the story of a young shepherd who used wisdom to become king, found in a book under an acacia tree.",
    "A book decorated with feathers holds the tale of the firebird that stole the sun and brought light to the earth.",
    "You find a book that tells of a giant who built mountains and valleys with his powerful hands.",
    "Opening a book, you remember the journey of the magic canoe that sailed across the land to escape a great flood.",
    "A book buried under sand reveals the story of the desert rose, which bloomed once every hundred years.",
    "You uncover the legend of the two brothers who created the stars and the moon from a book hidden in the forest.",
    "In a book with a map, you find the tale of the explorer who found the edge of the world.",
    "You discover the story of the wind rider, who tamed the stormy skies to save his village.",
    "A book filled with ancient coins tells the tale of the greedy king who was turned into a golden statue.",
    "Inside a book bound with iron, you find the legend of the warrior who forged peace with his enemies.",
    "You recall the story of the sage who could speak to animals, found in a book near a tranquil pond.",
    "A book hidden by thorns holds the tale of the princess who overcame the serpent to reclaim her throne.",
    "You uncover the story of the fisherman who caught a fish that granted wishes, inside a book by the lakeside.",
    "A book on a hilltop reveals the tale of the maiden who turned into a dove and escaped her captors.",
    "Inside a book surrounded by wildflowers, you discover the legend of the healer who cured an ailing kingdom.",
    "You find the tale of the great flood and the hero who rebuilt the world from a book submerged in a stream.",
    "A book in the shadow of a baobab tree holds the story of the first hunter, who learned the secrets of the wild.",
    "You unlock a book to find the story of the night spirit who taught the villagers to dream.",
];

  // Create and type out the message text
  const messageText = scene.add.text(centerX - 190, centerY - 172, '', {
    fontSize: 'bold 19px',
    fill: '#000000',
    wordWrap: { width: 390, useAdvancedWrap: true },
    lineSpacing: 10,
  }).setScrollFactor(0);

  typeText(scene, messageText, messageOptions[Math.floor(Math.random() * messageOptions.length)], 0, 0, () => {questionGenerator()}, 2000);

  // Continue from the questionGenerator function
  const questionGenerator = () => {
    messageText.destroy();
    textBox.disableInteractive();
    let chestOptions = '';
    let currentLevelArray = gameState.level;

    // Determine the appropriate set of questions based on the current level
    if (questionsChestsPagesActive[currentLevelArray].length > 0) {
      gameState.randomIndex = Math.floor(Math.random() * questionsChestsPagesActive[currentLevelArray].length);
      chestOptions = questionsChestsPagesActive[currentLevelArray][gameState.randomIndex];
    } else {
      currentLevelArray -= 1;
      gameState.randomIndex = Math.floor(Math.random() * questionsChestsPagesActive[currentLevelArray].length);
      chestOptions = questionsChestsPagesActive[currentLevelArray][gameState.randomIndex];
    }

    // Generate each option
    for (let i = 0; i < 3; i++) {
      let option = chestOptions.options[i];
      let question = chestOptions.question;
      let answer = option.answer; 

      const messageText = scene.add.text(centerX - 190, centerY - 172, '', {
        fontSize: 'bold 16px',
        fill: '#000000',
        wordWrap: { width: 390, useAdvancedWrap: true },
        lineSpacing: 10,
      }).setScrollFactor(0);

      // Create the question text
      const questionText = scene.add.text(centerX - 190, centerY - 170, '', {
        fontSize: 'bold 19px', 
        fill: '#000000',
        wordWrap: { width: 390, useAdvancedWrap: true },
        lineSpacing: 10,
      }).setScrollFactor(0);
      typeText(scene, questionText, question);

      // Create the option boxes and text
      const optionBoxX = centerX;
      const optionBoxY = centerY + 32 + i * 60; // Adjust the Y position for each option
      const optionBox = scene.add.rectangle(optionBoxX, optionBoxY, 400, 55, 0xFFFFFF).setScrollFactor(0);
      optionBox.setStrokeStyle(1, 0x000000, 1);
  
      const optionText = scene.add.text(optionBoxX - 190, optionBoxY - 20, '', {
        fontSize: 'bold 15px', 
        fill: '#000000',
        wordWrap: { width: 380, useAdvancedWrap: true }
      }).setScrollFactor(0);

      typeText(scene, optionText, option.option, 2000 + question.length * 50, 0,() => {optionBox.setInteractive();});

      destroyArray.push({questionText, optionBox, optionText, messageText}); 

      let optionBoxActive = true; 

      // Interactivity for option box: highlight on hover
      optionBox.on('pointerover', () => {
        if (optionBoxActive) {
          optionBox.setStrokeStyle(5, 0x000000, 1);
        }
      });

      // Revert style when the pointer is no longer over the option box
      optionBox.on('pointerout', () => {
        if (optionBoxActive) {
          optionBox.setStrokeStyle(1, 0x000000, 1);
        }
      });

      // The answerResult function determines the outcome of the player's choice.
      const answerResult = (input) => {
        // Check if the player's input indicates a correct answer (1).
        if (input === 1) {
          // If correct:
          // Add key 
          gameState.keys += 1;
          gameState.keysTotal += 1; 
          console.log(gameState.keysTotal);
          gameState.chestBoxActive -= 1;
          // Remove the question, option boxes, and text from the screen.
          textBox.destroy();
          textBoxb.destroy();
          destroyArray.forEach(item => {
            item.questionText.destroy();
            item.optionBox.destroy();
            item.optionText.destroy();
            item.messageText.destroy();
          });
          // Clear the array holding the elements to ensure they don't linger in memory.
          destroyArray.length = 0;

          // Convert the player's world coordinates to tile coordinates
          const playerTileX = scene.groundLayer.worldToTileX(scene.player.sprite.x);
          const playerTileY = scene.groundLayer.worldToTileY(scene.player.sprite.y);
          // Retrieve the room object where the player is currently located
          const playerRoom = scene.dungeon.getRoomAt(playerTileX, playerTileY);
          // Access the center coordinates of the player's room
          const roomCenterX = playerRoom.centerX;
          const roomCenterY = playerRoom.centerY;

          const chestClosed = scene.add.image(roomCenterX * 64 + 32, roomCenterY * 64 + 32, chestopen);
          chestClosed.setDepth(0);
      
          // Reset the score, resume the physics and reset the camera zoom to indicate the game is continuing.
          gameState.displayKeys.setText(`You need 6 books to continue. You have: ${gameState.keys} .\nCurrent level: ${scene.level}`)
          scene.physics.world.resume();
          scene.cameras.main.zoom = 1;

        } else {
          // If incorrect:
          // Remove the question, option boxes, and text as done for the correct case.
          gameState.chestBoxActive -= 1;
          gameState.speed += 100;
          console.log(gameState.speed);
          textBox.destroy();
          textBoxb.destroy();
          destroyArray.forEach(item => {
            item.questionText.destroy();
            item.optionBox.destroy();
            item.optionText.destroy();
            item.messageText.destroy();
          });

          // Convert the player's world coordinates to tile coordinates
          const playerTileX = scene.groundLayer.worldToTileX(scene.player.sprite.x);
          const playerTileY = scene.groundLayer.worldToTileY(scene.player.sprite.y);
          // Retrieve the room object where the player is currently located
          const playerRoom = scene.dungeon.getRoomAt(playerTileX, playerTileY);
          // Access the center coordinates of the player's room
          const roomCenterX = playerRoom.centerX;
          const roomCenterY = playerRoom.centerY;

          const chestClosed = scene.add.image(roomCenterX * 64 + 32, roomCenterY * 64 + 32, chestopen);
          chestClosed.setDepth(0);
          
          scene.physics.world.resume();
          scene.cameras.main.zoom = 1;
        }
      };


      // Event listener for when the player selects an option.
      optionBox.on('pointerup', () => {
        // Check if the selected option is correct.
        if (answer === 1) {
          // Correct answer logic:
          // Change the style of the option box to indicate correctness.
          optionBoxActive = false;
          optionBox.setStrokeStyle(5, 0x228B22, 1); 
          // Disable interaction for all option boxes.
          destroyArray.forEach(item => {
            item.optionBox.disableInteractive();
          });

          // Remove the answered question from the active question pool.
          questionsChestsPagesActive[currentLevelArray].splice(gameState.randomIndex, 1);

          // If the current level's questions are depleted, reset for new round.
          if (currentLevelArray === 0 && questionsChestsPagesActive[currentLevelArray].length === 0) {
            resetPages();
            currentLevelArray = gameState.level;
          }

          // Generate a response message for a correct answer.
          const responseOptions = [
            `When you choose '${option.option}', the book locks magically, and a soft whisper reassures you, 'you are on the right path, my child.'`,
            `After you say '${option.option}' quietly, the book fades away. You feel a surge of accomplishment.`,
            `In response to '${option.option}', the air around you fills with echoes of ancient tales, and the ground beneath you vibrates with hidden power.`,
            `As you say '${option.option}', the book bursts into a bright light. A spectral figure appears, nodding in approval of your choice.`,
            `Choosing '${option.option}' makes the book dissolve into glowing motes that dance around you, unveiling visions of forgotten myths.`,
            `After picking '${option.option}', the book vanishes with a soft hum. A distant voice praises, 'You're on the right path, my friend.'`,
            `Upon saying '${option.option}' quietly, the book transports itself to another realm. You sense that your decision was wise.`,
            `Selecting '${option.option}', the atmosphere grows wise, and the earth pulses with hidden energies.`,
            `Deciding on '${option.option}', the book transforms into sparkling lights. They swirl around, revealing visions of ancient secrets.`,
            `Upon uttering '${option.option}', the book's lid flutters rapidly before disappearing, accompanied by whispers of age-old mysteries.`,
            `With the choice of '${option.option}', the book emits a harmonious melody, each note resonating with wisdom and insight.`,
            `As '${option.option}' escapes your lips, the book turns into a radiant orb of light, leading you down a mystical path.`,
            `Selecting '${option.option}' causes the book to burst into countless fragments, each shimmering with knowledge.`,
            `The moment you decide on '${option.option}', the book explodes into a cloud of golden dust, enveloping you with a sense of ancient wisdom.`,
            `By opting for '${option.option}', the book's surface glows, and ethereal scripts form in the air, hinting at destinies yet to be fulfilled.`,
            `Choosing '${option.option}' transforms the book into a glowing key, suggesting it may unlock further mysteries yet to be discovered.`,
            `With the utterance of '${option.option}', the book releases a soft light, casting shadows that weave tales of ancient legends long forgotten.`
          ];
          
          // Destroy the text of the previous question.
          destroyArray.forEach(item => {
            item.questionText.destroy();
          });

          // Display the correct answer response and trigger the answer result after a delay.
          typeText(scene, messageText, responseOptions[Math.floor(Math.random() * responseOptions.length)], 0, 0, () => { answerResult(1); }, 2000);
          
        } else {
          // Incorrect answer logic:
          // Change the style of the option box to indicate incorrectness.
          optionBoxActive = false; 
          optionBox.setStrokeStyle(5, 0xff0000, 1);
          // Disable interaction for all option boxes.
          destroyArray.forEach(item => {
            item.optionBox.disableInteractive();
          });

          // Generate a response message for an incorrect answer.
          const responseOptions = [
            `When you choose '${option.option}', the book locks abruptly, leaving you with a sense of uncertainty and a lingering doubt.`,
            `After you mutter '${option.option}' under your breath, the book fades away to another realm. You can't shake the feeling that something went wrong.`,
            `As you utter '${option.option}', the book emits a harsh glare of light, and a disapproving specter appears, shaking its head at your choice.`,
            `Choosing '${option.option}' results in the book dissolving into ominous shadows that swirl menacingly around you, hinting at dark secrets.`,
            `After selecting '${option.option}', the book vanishes abruptly, leaving you in silence and a creeping sense of isolation.`,
            `Upon saying '${option.option}', the book shifts dimensions abruptly. Doubt clouds your mind, making you question your choice.`,
            `Deciding on '${option.option}', the air feels oppressive, and the ground throbs with an ominous energy that makes you question your decision.`,
            `As you pick '${option.option}', the book disintegrates into eerie particles that swarm around, whispering unsettling truths and leaving you uneasy.`,
            `With the choice of '${option.option}', the book's contents turn blood red then vanish. A cold wind blows, chilling you with a growing sense of dread.`,
            `Upon uttering '${option.option}', the symbols on the book scramble chaotically before disappearing. The air grows heavy, filling you with deep unease.`,
            `After declaring '${option.option}', the book crumbles to dust. The room darkens momentarily, engulfing you in a profound sense of loss.`,
            `Choosing '${option.option}' causes the book to emit a low, dissonant hum before it fades away, leaving a shadow that casts doubt on the wisdom of your choice.`,
            `By opting for '${option.option}', the book's lid turns blank and then vanishes. The ensuing silence is heavy, loaded with unspoken warnings and regrets.`,
            `When '${option.option}' is chosen, the book shudders and disappears. You're left in unsettling quiet, pondering the eerie absence it has left behind.`,
            `As '${option.option}' is spoken, the book flickers like a dying flame and then is gone. A sense of foreboding lingers, leaving you to wonder what you've unleashed.`,
            `Selecting '${option.option}' makes the book's surface warp and then fade. The unsettling transformation leaves you questioning the nature of your decision.`
        ];
        
          // Destroy the text of the previous question.
          destroyArray.forEach(item => {
            item.questionText.destroy();
          });

          // Display the incorrect answer response and trigger the answer result after a delay.
          typeText(scene, messageText, responseOptions[Math.floor(Math.random() * responseOptions.length)], 0, 0, () => { answerResult(0); }, 2000);
        }
      });
    }  
  }

  chestBox.destroy();
}

export { questionsChestsPages, questionChestFunction };
